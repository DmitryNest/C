    
#include <stdio.h>
#include <stdlib.h>


float vectorarifmetick_file(FILE *inputfile, FILE *outputfile, char operation){
    float d; //Временное хранилище для арифметических операция
    float *vector1 = NULL, *vector2 = NULL; // Объявлеие указателей к массивам с векторами
    int izmerenie; // Переменная для работы с динамической памятью. ОПеределение длинны вектора

    fscanf(inputfile, "%i", &izmerenie); //опредление длинны вектора

    vector1 = malloc(izmerenie * sizeof(float)); // Выделение памяти для вектора 1 и считывание результатов
    for (int i = 0; i < izmerenie; i++) { //Ввод первого вектора с использованием массива
        fscanf(inputfile, "%f", &vector1[i]);
    }

    vector2 = malloc(izmerenie * sizeof(float)); // Выделение памяти для вектора 2 и считывание результатов
    for (int i = 0; i < izmerenie; i++) { // Аналогично и тут
        fscanf(inputfile, "%f", &vector2[i]);
    }

    switch (operation){ // Вызов операции
        case '+': // Операция сложения
            fprintf(outputfile, "("); //открывающаяся скобка для вектора
            for (int i = 0; i < izmerenie; i++){
                fprintf(outputfile,"%.2f\t",vector1[i]); //Последовательный вывод с табуляцией в файл
            }
            fprintf(outputfile, "\b) ("); // Закрывающаяся скобка и удаления последней табуляции.
            for (int i = 0; i < izmerenie; i++){
                fprintf(outputfile,"%.2f\t",vector2[i]);
            }
            fprintf(outputfile, "\b) = (");
            for (int i = 0; i < izmerenie; i++) { //Операции с ветором и вывод их на экрна
                d = vector1[i] + vector2[i];
                fprintf(outputfile,"%.2f\t", d);
            }
            fprintf(outputfile, "\b)");
            free(vector1);
            free(vector2); // Освобождение динамической памяти
            break;
        case '-': // Аналогичено для вычитания и умножения. Считывание, операция и вывод  вектора
            fprintf(outputfile, "(");
            for (int i = 0; i < izmerenie; i++){
                fprintf(outputfile,"%.2f\t",vector1[i]);
            }
            fprintf(outputfile, "\b) (");
            for (int i = 0; i < izmerenie; i++){
                fprintf(outputfile,"%.2f\t",vector2[i]);
            }
            fprintf(outputfile, "\b) = (");
            for (int i = 0; i < izmerenie; i++) { //Операции с ветором и вывод их на экрна
                d = vector1[i] - vector2[i];
                fprintf(outputfile,"%.2f\t", d);
            }
            fprintf(outputfile, "\b)");
            free(vector1); //Осовобождаем память
            free(vector2);
            break;
        case '*':
            fprintf(outputfile, "(");
            for (int i = 0; i < izmerenie; i++){
                fprintf(outputfile,"%.2f\t",vector1[i]);
            }
            fprintf(outputfile, "\b) (");
            for (int i = 0; i < izmerenie; i++){
                fprintf(outputfile,"%.2f\t",vector2[i]);
            }
            fprintf(outputfile, "\b) = (");
            for (int i = 0; i < izmerenie; i++) { //Операции с ветором и вывод их на экрна
                d = vector1[i] + vector2[i];
                fprintf(outputfile,"%.2f\t", d);
            }
            fprintf(outputfile, "\b)");
            free(vector1);
            free(vector2);
            break;


    }


}

float chisla_file(FILE *inputfile, FILE *outputfile,  char operation) { //Простые операции. Сложение умножение. Работа с файлами. К аргументам функции добавляем указатели для дальнейшего продвижения по файлу
    float *a = NULL, *b = NULL; //изначально указатели указывают на NULL. После выделим для них память
    float result;
    a = calloc(1, sizeof(float)); // Выделение ячейки для числа а и б
    b = calloc(1, sizeof(float));

    fscanf(inputfile, "%f", a); //Считываем с файла
    fscanf(inputfile, "%f", b);
    switch (operation) {
        case '+':
            fprintf(outputfile, "Результат вычислений: %.2f", (*a) + (*b));
            break;
        case '-':
            fprintf(outputfile, "Результат вычислений: %.2f", (*a) - (*b));
            break;
        case '*':
            fprintf(outputfile, "Результат вычислений: %.2f", (*a) * (*b));
            break;
        case '/':
            fprintf(outputfile, "Результат вычислений: %.2f", (*a) / (*b));
            break;
        case '!': //факториал
            result = *a; 
            for (int i = 1; i <= (*a); i++) {
                result = result * i;
            }

            fprintf(outputfile, "Результат вычислений: %.2f", result);
            break;
        case '^': //Возвездение в степень. Все операции практически идентичны с прошлым калькулятором
            result = *a;
            if ((*b) != 0) {
                for (int i = 1; i < (*b); i++) {
                    (*a) = (*a) * result;
                }
            } else {
                *a = 1;
            }
            fprintf(outputfile, "Результат вычислений: %.2f", *a);
            break;
    }
}


int main(void) {
    char operation, calc; //operation- операция сложения, умножение и тд а calc- Арифметика с числами или векторами
    FILE *inputfile, *outputfile; // Объявляем указатели для файлов
    inputfile = fopen("C:\\Files\\input.txt", "r"); //Открытие первого файла для чтения.
    outputfile = fopen("C:\\Files\\output.txt", "w"); //Второго для записи

    fscanf(inputfile,"%c %c", &operation, &calc);
    if (calc == 's'){ //Опеределям операцию по второму символу.
        chisla_file(inputfile, outputfile, operation); 
    }
    else{
        vectorarifmetick_file(inputfile, outputfile, operation);
    }

    fclose(inputfile);
    fclose(outputfile); //Закрытие файла
    return 0;
}
